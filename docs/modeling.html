<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Modeling | Skin Laundry Technical Assessment</title>
  <meta name="description" content="3 Modeling | Skin Laundry Technical Assessment" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Modeling | Skin Laundry Technical Assessment" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Modeling | Skin Laundry Technical Assessment" />
  
  
  

<meta name="author" content="Austin Kolvek" />


<meta name="date" content="2025-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="eda.html"/>
<link rel="next" href="summary.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Skin Laundry Technical Assessment</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Assessment Objective</a></li>
<li class="chapter" data-level="2" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>2</b> EDA</a></li>
<li class="chapter" data-level="3" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>3</b> Modeling</a></li>
<li class="chapter" data-level="4" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>4</b> Summary</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Skin Laundry Technical Assessment</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Modeling<a href="modeling.html#modeling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Lets bring in the data from the EDA and the promotion data!</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="modeling.html#cb19-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">austi</span><span class="sc">\\</span><span class="st">OneDrive</span><span class="sc">\\</span><span class="st">Documents</span><span class="sc">\\</span><span class="st">skinlaundryapp</span><span class="sc">\\</span><span class="st">subset_data.csv&#39;</span>)</span>
<span id="cb19-2"><a href="modeling.html#cb19-2" tabindex="-1"></a>promo_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">austi</span><span class="sc">\\</span><span class="st">OneDrive</span><span class="sc">\\</span><span class="st">Documents</span><span class="sc">\\</span><span class="st">Interviews</span><span class="sc">\\</span><span class="st">Skin Laundry</span><span class="sc">\\</span><span class="st">Promotion details and dates.csv&#39;</span>)</span></code></pre></div>
<p>Check to make sure the data looks good.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="modeling.html#cb20-1" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb20-2"><a href="modeling.html#cb20-2" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb20-3"><a href="modeling.html#cb20-3" tabindex="-1"></a><span class="fu">str</span>(data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    1353 obs. of  5 variables:
##  $ clinic.name  : chr  &quot;Clinic G&quot; &quot;Clinic G&quot; &quot;Clinic G&quot; &quot;Clinic G&quot; ...
##  $ sale.date    : chr  &quot;2022-01-02 00:00:00&quot; &quot;2022-01-02 00:00:00&quot; &quot;2022-01-02 00:00:00&quot; &quot;2023-01-02 00:00:00&quot; ...
##  $ product.name : chr  &quot;Hyaluronic Acid Serum&quot; &quot;Hyaluronic Acid Serum&quot; &quot;Hyaluronic Acid Serum&quot; &quot;Hyaluronic Acid Serum&quot; ...
##  $ quantity.sold: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ Promotion    : chr  &quot;No Promotion&quot; &quot;No Promotion&quot; &quot;No Promotion&quot; &quot;No Promotion&quot; ...</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="modeling.html#cb22-1" tabindex="-1"></a><span class="co">#There needs to get one observation per day</span></span>
<span id="cb22-2"><a href="modeling.html#cb22-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="modeling.html#cb22-3" tabindex="-1"></a>  <span class="fu">group_by</span>(sale.date, clinic.name, product.name,Promotion) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="modeling.html#cb22-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_quantity_sold =</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">quantity.sold</span><span class="st">`</span>), <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span>)</span></code></pre></div>
<p>To build a time series model, I am going to convert the data into a tsibble.
This gets our data into the correct format and makes model building much
easier.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="modeling.html#cb23-1" tabindex="-1"></a>data<span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="modeling.html#cb23-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sale.date =</span> <span class="fu">as.Date</span>(sale.date)) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="modeling.html#cb23-3" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> sale.date)<span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="modeling.html#cb23-4" tabindex="-1"></a>  <span class="fu">fill_gaps</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="modeling.html#cb23-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_quantity_sold =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(total_quantity_sold), <span class="dv">0</span>, total_quantity_sold)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="modeling.html#cb23-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Promotion =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Promotion),<span class="st">&quot;No Promotion&quot;</span>, Promotion)) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="modeling.html#cb23-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clinic.name =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(clinic.name),<span class="st">&quot;Clinic G&quot;</span>, clinic.name)) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="modeling.html#cb23-8" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">product.name =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(product.name),<span class="st">&quot;Hyaluronic Acid Serum&quot;</span>, product.name))</span></code></pre></div>
<p>I am going to split the data into a training and test set. The training set
will be all the data up until July of 2024 and the test set will be all of the
data from July 2024-September 2024.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="modeling.html#cb24-1" tabindex="-1"></a>train <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="modeling.html#cb24-2" tabindex="-1"></a>  <span class="fu">select</span>(total_quantity_sold, sale.date, Promotion) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="modeling.html#cb24-3" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="sc">~</span> <span class="st">&quot;2024-06-30&quot;</span>)</span>
<span id="cb24-4"><a href="modeling.html#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="modeling.html#cb24-5" tabindex="-1"></a>test <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="modeling.html#cb24-6" tabindex="-1"></a>  <span class="fu">select</span>(total_quantity_sold, sale.date, Promotion) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="modeling.html#cb24-7" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">&quot;2024-07-01&quot;</span> <span class="sc">~</span> <span class="st">&quot;2024-09-30&quot;</span>)</span></code></pre></div>
<p>Lets get a basic look for what the data looks like over time.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="modeling.html#cb25-1" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb25-2"><a href="modeling.html#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="modeling.html#cb25-3" tabindex="-1"></a><span class="fu">autoplot</span>(train, total_quantity_sold) <span class="sc">+</span></span>
<span id="cb25-4"><a href="modeling.html#cb25-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_quantity_sold)) <span class="sc">+</span></span>
<span id="cb25-5"><a href="modeling.html#cb25-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Promotion)) <span class="sc">+</span></span>
<span id="cb25-6"><a href="modeling.html#cb25-6" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb25-7"><a href="modeling.html#cb25-7" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="st">&quot;1 month&quot;</span>,  <span class="co"># Set the breaks to monthly intervals</span></span>
<span id="cb25-8"><a href="modeling.html#cb25-8" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">date_format</span>(<span class="st">&quot;%b %Y&quot;</span>)  <span class="co"># Format the labels as Month-Year</span></span>
<span id="cb25-9"><a href="modeling.html#cb25-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-10"><a href="modeling.html#cb25-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>This is a very messy graph but a few points are good to point out. When there is
a spike in sales for the product, there seems to be a promotion attached to the
spike. It is note worthy to point out the 30% off all products, 30% off product,
and Buy 2 Get Cleanser free are the promotions that have the biggest spikes in
the data. On the flip side, the Spend more Save more, Buy 3 Get 1 free, and 10%
off serums don’t seem to boost sales for this specific product.</p>
<p>I am going to create a STL Decomposition to decide if the data has
seasonality or a trend to it.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="modeling.html#cb26-1" tabindex="-1"></a>stl <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="modeling.html#cb26-2" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(total_quantity_sold))</span>
<span id="cb26-3"><a href="modeling.html#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="modeling.html#cb26-4" tabindex="-1"></a><span class="fu">components</span>(stl)</span></code></pre></div>
<pre><code>## # A dable: 911 x 8 [1D]
## # Key:     .model [1]
## # :        total_quantity_sold = trend + season_year + season_week + remainder
##    .model sale.date  total_quantity_sold trend season_week season_year remainder season_adjust
##    &lt;chr&gt;  &lt;date&gt;                   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 stl    2022-01-02                   3  1.10      0.579        0.293    1.03           2.13 
##  2 stl    2022-01-03                   0  1.10      0.368       -0.684   -0.787          0.316
##  3 stl    2022-01-04                   1  1.10     -0.391        0.884   -0.597          0.506
##  4 stl    2022-01-05                   0  1.10     -0.296        0.134   -0.940          0.163
##  5 stl    2022-01-06                   0  1.10      0.219       -1.25    -0.0710         1.03 
##  6 stl    2022-01-07                   0  1.10     -0.0131      -0.707   -0.383          0.720
##  7 stl    2022-01-08                   1  1.10     -0.460        0.459   -0.102          1.00 
##  8 stl    2022-01-09                   0  1.10      0.561       -0.710   -0.954          0.149
##  9 stl    2022-01-10                   0  1.10      0.391       -1.34    -0.154          0.949
## 10 stl    2022-01-11                   0  1.10     -0.407       -1.14     0.448          1.55 
## # ℹ 901 more rows</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="modeling.html#cb28-1" tabindex="-1"></a><span class="fu">components</span>(stl) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="modeling.html#cb28-2" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="modeling.html#cb29-1" tabindex="-1"></a>train <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="modeling.html#cb29-2" tabindex="-1"></a>  <span class="fu">features</span>(total_quantity_sold, feat_stl)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 9
##   trend_strength seasonal_strength_week seasonal_peak_week seasonal_trough_week spikiness linearity curvature stl_e_acf1 stl_e_acf10
##            &lt;dbl&gt;                  &lt;dbl&gt;              &lt;dbl&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
## 1          0.360                  0.273                  6                    1  0.000147      7.03      4.91    -0.0497       0.224</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="modeling.html#cb31-1" tabindex="-1"></a><span class="co">#trend = 0.3596</span></span>
<span id="cb31-2"><a href="modeling.html#cb31-2" tabindex="-1"></a><span class="co">#seasonality = 0.2737</span></span></code></pre></div>
<p>There is not enough evidence to suggest there to be a trend or seasonality in
the data.</p>
<p>The next step is to figure out if the data is stationary. I am going to perform
a KPSS test to determine if there is stationarity or not.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="modeling.html#cb32-1" tabindex="-1"></a><span class="co">#What should the alpha level be?</span></span>
<span id="cb32-2"><a href="modeling.html#cb32-2" tabindex="-1"></a><span class="fu">pchisq</span>(<span class="fu">log</span>(<span class="dv">909</span>),<span class="dv">1</span>,<span class="at">lower.tail =</span> F)</span></code></pre></div>
<pre><code>## [1] 0.00905298</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="modeling.html#cb34-1" tabindex="-1"></a><span class="co">#alpha level = 0.00905298</span></span>
<span id="cb34-2"><a href="modeling.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="modeling.html#cb34-3" tabindex="-1"></a>train <span class="sc">%&gt;%</span> <span class="fu">features</span>(total_quantity_sold, unitroot_kpss)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   kpss_stat kpss_pvalue
##       &lt;dbl&gt;       &lt;dbl&gt;
## 1     0.892        0.01</code></pre>
<p>Since our p-value is to high, this suggest that the data is a random walk.
It is not possible to forecast a random walk so in order to combat this, I am
going to difference the quantity sold variable(The response variable). This will
let us be able to create a forecast.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="modeling.html#cb36-1" tabindex="-1"></a>train <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="modeling.html#cb36-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_quantity =</span> <span class="fu">difference</span>(total_quantity_sold))</span></code></pre></div>
<p>Next I am going to look at a Auto Correlation(ACF) and Partial Auto Correlation
(PACF) plot to determine the patterns in the data.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="modeling.html#cb37-1" tabindex="-1"></a>train <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="modeling.html#cb37-2" tabindex="-1"></a>  <span class="fu">gg_tsdisplay</span>(diff_quantity, <span class="at">plot_type =</span> <span class="st">&#39;partial&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range (`geom_point()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-19-1.png" width="672" />
Notes from the ACF and PACF plot:</p>
<p>To me, it looks like there is an exponential decrease in the pacf plot. This
suggests that there are no auto regressive(AR) terms in the data and we should
only be looking at how many moving average(MA) terms to add to our model.
With the acf plot, there is a clear big spike at lag 1 and then a consistent
hovering pattern around the confidence interval. This suggest there is one MA
term that needs to be in the model.</p>
<p>Moving forward, I will create a handful of different models to see which one
works the best. Based on the AIC and BIC selection criteria, I will decide
which model to move forward with.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="modeling.html#cb40-1" tabindex="-1"></a>models <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">model</span>(</span>
<span id="cb40-2"><a href="modeling.html#cb40-2" tabindex="-1"></a>  <span class="at">auto =</span> <span class="fu">ARIMA</span>(diff_quantity),</span>
<span id="cb40-3"><a href="modeling.html#cb40-3" tabindex="-1"></a>  <span class="at">step =</span> <span class="fu">ARIMA</span>(diff_quantity, <span class="at">stepwise =</span> <span class="cn">FALSE</span>),</span>
<span id="cb40-4"><a href="modeling.html#cb40-4" tabindex="-1"></a>  <span class="at">MA1 =</span> <span class="fu">ARIMA</span>(diff_quantity <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb40-5"><a href="modeling.html#cb40-5" tabindex="-1"></a>  <span class="at">MA7 =</span> <span class="fu">ARIMA</span>(diff_quantity <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">7</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),</span>
<span id="cb40-6"><a href="modeling.html#cb40-6" tabindex="-1"></a>  <span class="at">ARIMA91 =</span> <span class="fu">ARIMA</span>(diff_quantity <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">9</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb40-7"><a href="modeling.html#cb40-7" tabindex="-1"></a>)</span>
<span id="cb40-8"><a href="modeling.html#cb40-8" tabindex="-1"></a></span>
<span id="cb40-9"><a href="modeling.html#cb40-9" tabindex="-1"></a>model_results <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(models)</span>
<span id="cb40-10"><a href="modeling.html#cb40-10" tabindex="-1"></a></span>
<span id="cb40-11"><a href="modeling.html#cb40-11" tabindex="-1"></a><span class="fu">glance</span>(models)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 8
##   .model  sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots 
##   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
## 1 auto      3.39  -1844. 3701. 3701. 3730. &lt;cpl [5]&gt; &lt;cpl [0]&gt;
## 2 step      3.39  -1844. 3701. 3701. 3730. &lt;cpl [5]&gt; &lt;cpl [0]&gt;
## 3 MA1       5.06  -2030. 4063. 4063. 4073. &lt;cpl [0]&gt; &lt;cpl [1]&gt;
## 4 MA7       3.11  -1810. 3637. 3637. 3675. &lt;cpl [0]&gt; &lt;cpl [7]&gt;
## 5 ARIMA91   3.14  -1811. 3643. 3644. 3696. &lt;cpl [9]&gt; &lt;cpl [1]&gt;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="modeling.html#cb42-1" tabindex="-1"></a>models <span class="sc">%&gt;%</span> <span class="fu">select</span>(ARIMA91) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range (`geom_point()`).</code></pre>
<pre><code>## Warning: Removed 1 row containing non-finite outside the scale range (`stat_bin()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="modeling.html#cb46-1" tabindex="-1"></a><span class="fu">augment</span>(models) <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="modeling.html#cb46-2" tabindex="-1"></a>  <span class="fu">filter</span>(.model <span class="sc">==</span> <span class="st">&#39;ARIMA91&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="modeling.html#cb46-3" tabindex="-1"></a>  <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">dof =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model  lb_stat lb_pvalue
##   &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 ARIMA91    11.2   0.00363</code></pre>
<p>For the ARIMA models, I decided to pick a model with 9 AR terms, 1 MA terms, and
took a difference. I choose this setup by looking at the ACF and PACF plots.
The PACF plot looked liked it had an exponential decrease in it. Apon further
examination at the tail end of the plot, the 20th and 27th lags show signs
of being included in the model which tells me there needs to be AR terms in the
model.</p>
<p>After building the model, I looked at the residuals to determine if white noise
was left over. I assessed white noise in two ways. The first was looking at the
residual plot. I am comfortable with the distribution of the residuals being
normal and the ACF plot being close to the bounds of the confidence interval.
The second was performing a Lijung Box test. With a p-value of 0.003 and the
alpha level being 0.008, this tells me there is a little bit of noise that
can still be modeled.</p>
<p>When looking at the original plot, there was a point intervention that stood
out to me. By including this point into the model, I think it might reduce the
noise in the model to only have white noise left over.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="modeling.html#cb48-1" tabindex="-1"></a><span class="co">#Point intervention 692</span></span>
<span id="cb48-2"><a href="modeling.html#cb48-2" tabindex="-1"></a><span class="co"># Add a point intervention column to both the Train AND Test sets</span></span>
<span id="cb48-3"><a href="modeling.html#cb48-3" tabindex="-1"></a>train<span class="sc">$</span>point <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">911</span>)</span>
<span id="cb48-4"><a href="modeling.html#cb48-4" tabindex="-1"></a>test<span class="sc">$</span>point <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">92</span>)</span>
<span id="cb48-5"><a href="modeling.html#cb48-5" tabindex="-1"></a></span>
<span id="cb48-6"><a href="modeling.html#cb48-6" tabindex="-1"></a>train<span class="sc">$</span>point[<span class="dv">692</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb48-7"><a href="modeling.html#cb48-7" tabindex="-1"></a></span>
<span id="cb48-8"><a href="modeling.html#cb48-8" tabindex="-1"></a><span class="co"># Fit ARIMA model with intervention</span></span>
<span id="cb48-9"><a href="modeling.html#cb48-9" tabindex="-1"></a>models_point <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">model</span>(</span>
<span id="cb48-10"><a href="modeling.html#cb48-10" tabindex="-1"></a>  <span class="at">point_intervention =</span> <span class="fu">ARIMA</span>(diff_quantity <span class="sc">~</span> point <span class="sc">+</span> <span class="fu">lag</span>(point) <span class="sc">+</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">9</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">PDQ</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb48-11"><a href="modeling.html#cb48-11" tabindex="-1"></a>)</span>
<span id="cb48-12"><a href="modeling.html#cb48-12" tabindex="-1"></a></span>
<span id="cb48-13"><a href="modeling.html#cb48-13" tabindex="-1"></a><span class="co"># Glance at model summary</span></span>
<span id="cb48-14"><a href="modeling.html#cb48-14" tabindex="-1"></a><span class="fu">glance</span>(models_point)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   .model             sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots 
##   &lt;chr&gt;               &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
## 1 point_intervention   2.39  -1687. 3400. 3400. 3462. &lt;cpl [9]&gt; &lt;cpl [1]&gt;</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="modeling.html#cb50-1" tabindex="-1"></a><span class="co"># Visualize residuals of the point intervention model</span></span>
<span id="cb50-2"><a href="modeling.html#cb50-2" tabindex="-1"></a>models_point <span class="sc">%&gt;%</span> <span class="fu">select</span>(point_intervention) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range (`geom_line()`).</code></pre>
<pre><code>## Warning: Removed 1 row containing missing values or values outside the scale range (`geom_point()`).</code></pre>
<pre><code>## Warning: Removed 1 row containing non-finite outside the scale range (`stat_bin()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="modeling.html#cb54-1" tabindex="-1"></a><span class="co"># Ljung-Box test for autocorrelation in the residuals</span></span>
<span id="cb54-2"><a href="modeling.html#cb54-2" tabindex="-1"></a><span class="fu">augment</span>(models_point) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="modeling.html#cb54-3" tabindex="-1"></a>  <span class="fu">filter</span>(.model <span class="sc">==</span> <span class="st">&#39;point_intervention&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="modeling.html#cb54-4" tabindex="-1"></a>  <span class="fu">features</span>(.innov, ljung_box, <span class="at">lag =</span> <span class="dv">12</span>, <span class="at">dof =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .model             lb_stat lb_pvalue
##   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;
## 1 point_intervention    9.49   0.00868</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="modeling.html#cb56-1" tabindex="-1"></a><span class="co"># Forecasting the next 92 periods beyond the training data and plotting</span></span>
<span id="cb56-2"><a href="modeling.html#cb56-2" tabindex="-1"></a>forecast_values_point <span class="ot">&lt;-</span> models_point <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="modeling.html#cb56-3" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> test)</span>
<span id="cb56-4"><a href="modeling.html#cb56-4" tabindex="-1"></a></span>
<span id="cb56-5"><a href="modeling.html#cb56-5" tabindex="-1"></a><span class="co"># Extract forecasted values</span></span>
<span id="cb56-6"><a href="modeling.html#cb56-6" tabindex="-1"></a>forecasted_mean <span class="ot">&lt;-</span> forecast_values_point<span class="sc">$</span>.mean</span>
<span id="cb56-7"><a href="modeling.html#cb56-7" tabindex="-1"></a></span>
<span id="cb56-8"><a href="modeling.html#cb56-8" tabindex="-1"></a><span class="co"># Ensure your actual values match the forecast horizon length</span></span>
<span id="cb56-9"><a href="modeling.html#cb56-9" tabindex="-1"></a>actual_values <span class="ot">&lt;-</span> test<span class="sc">$</span>total_quantity_sold[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(forecasted_mean)]</span>
<span id="cb56-10"><a href="modeling.html#cb56-10" tabindex="-1"></a></span>
<span id="cb56-11"><a href="modeling.html#cb56-11" tabindex="-1"></a><span class="co"># Calculate residuals (difference between actual and forecasted values)</span></span>
<span id="cb56-12"><a href="modeling.html#cb56-12" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> actual_values <span class="sc">-</span> forecasted_mean</span>
<span id="cb56-13"><a href="modeling.html#cb56-13" tabindex="-1"></a></span>
<span id="cb56-14"><a href="modeling.html#cb56-14" tabindex="-1"></a><span class="co"># Calculate MAE (Mean Absolute Error)</span></span>
<span id="cb56-15"><a href="modeling.html#cb56-15" tabindex="-1"></a>MAE <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(residuals))</span>
<span id="cb56-16"><a href="modeling.html#cb56-16" tabindex="-1"></a>MAE</span></code></pre></div>
<pre><code>## [1] 1.418334</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="modeling.html#cb58-1" tabindex="-1"></a><span class="co">#MAE = 1.41</span></span></code></pre></div>
<p>When adding a point intervention to the data, the model seems to only have white
noise left over. I am comfortable with this conclusion due the residuals looking
like a normal distribution, the lags are within the range of the CI and the
Lijung Box p-value came back at 0.008 with an alpha level of 0.008.</p>
<p>To asses the accuracy of this model, I decided to use Mean Absolute Error(MAE).
When using this model to forecast future demand of the Hyulanioc Acid product
at clinic G for Q3, this model was 1.4 units off, on average.</p>
<p>In the summary section, I will give a more detailed overview wrapping this
analysis up and how Skin Laundry can use this model moving forward.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="eda.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Arayk22/skinlaundryapp.git/Modeling.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/Arayk22/skinlaundryapp.git/Modeling.qmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
